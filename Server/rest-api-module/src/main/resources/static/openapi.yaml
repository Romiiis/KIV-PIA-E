openapi: 3.0.3
info:
  title: KIV/PIA REST API
  description: blah
  version: 0.0.1
servers:
  - url: http://localhost:8080/
    description: Local development server
tags:
  - name: Auth
    description: API endpoints used for authentication and user registration.
  - name: Projects
    description: API endpoints used for management of translation projects.
  - name: Users
    description: API endpoints used for management of users (customers, translators, admins).
  - name: Me
    description: API endpoint to get details of the currently authenticated user.
  - name: TranslatorsLanguage
    description: API endpoints used for management of translator languages.
  - name: ProjectsFeedback
    description: API endpoints used for management of project feedback.
  - name: ProjectsWorkflow
    description: API endpoints used for managing project workflow (assignments, state transitions).
paths:

  # ----- Auth Endpoints -----
  /auth/login:
    post:
      tags:
        - Auth
      summary: Authenticates a user and returns a JWT token.
      description: >
        Takes user credentials (email and password) and returns
        a JWT access token if the credentials are valid. (ANYBODY CAN ACCESS permitAll)
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginUserRequest'

      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthJWTResponse'
        '400':
          description: Request body is not formatted correctly.
        '401':
          description: Invalid email or password.
        '500':
          description: Server error.
  /auth/register:
    post:
      tags:
        - Auth
      summary: Register a user and returns a JWT token.
      operationId: registerUser
      description: >
        Registers a new user (customer or translator) and returns
        a JWT access token upon successful registration. (ANYBODY CAN ACCESS permitAll)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterUserRequest'
      responses:
        '201':
          description: Registered successfully and created a new user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthJWTResponse'
        '400':
          description: Request body is not formatted correctly.
        '409':
          description: Email address is already in use.
        '500':
          description: Server error.
  /auth/refresh:
    post:
      tags:
        - Auth
      summary: Refreshes a JWT token
      description: >
        Takes a valid refresh token (usually from HttpOnly cookie)
        and issues a new access token. The refresh token itself
        is verified server-side. (ANYBODY CAN ACCESS permitAll)
      operationId: refreshToken
      security:
        - cookieAuth: [ ]
      responses:
        '200':
          description: Token refreshed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthJWTResponse'
        '401':
          description: Invalid or expired refresh token.
        '500':
          description: Server error.
  /auth/logout:
    post:
      tags:
        - Auth
      summary: Logs out the current user
      description: >
        Invalidates the current refresh token (server-side) and clears
        any authentication cookies. On the client side, the access token
        should also be deleted. (ALL ROLES USERS CAN ACCESS)
      operationId: logoutUser
      security:
        - bearerAuth: [ ]
        - cookieAuth: [ ]
      responses:
        '204':
          description: Logged out successfully (no content returned).
        '401':
          description: Unauthorized - no valid authentication token provided.
        '500':
          description: Server error.

  # ---- Me Endpoint -----
  /me:
    get:
      tags:
        - Me
      summary: Get the currently authenticated user's details
      description: >
        Retrieves the details of the currently authenticated user
        based on the provided JWT access token. (ALL ROLES USERS CAN ACCESS)
      operationId: getCurrentUser
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Current user details retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '500':
          description: Server error.


    # ------ END Auth Endpoints ------





    # ----- Project Endpoints -----


  # ----- User Endpoints -----
  /users:
    get:
      tags:
        - Users
      summary: Get all users
      operationId: listAllUsers
      description: >
        Retrieves a list of all users in the system. Using provided filters.
        (ADMIN only can access this endpoint.)
      parameters:
        - name: role
          in: query
          description: Filter users by their role (CUSTOMER, TRANSLATOR, ADMIN)
          required: false
          schema:
            $ref: '#/components/schemas/UserRole'
        - name: language
          in: query
          description: Filter users by a language they know (ISO code, e.g., "en" for English)
          required: false
          schema:
            type: string
            example: en
      responses:
        '200':
          description: A list of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListUsersResponse'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '500':
          description: Server error
  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: >
        Retrieves the details of a user by their unique ID.
        (ADMIN can see any user; SELF can see their own details -> Every role can access this endpoint.)
      operationId: getUserDetails
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: User not found

  # ----- Translator Language Endpoints -----
  /users/{id}/languages:
    get:
      tags:
        - TranslatorsLanguage
      summary: Get languages known by a user
      operationId: listUserLanguages
      description: >
        Retrieves the list of languages known by the specified user.
        (ADMIN or the translators themself (TRANSLATOR) can access this endpoint.)
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the user
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Languages retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListLanguagesResponse'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: User not found
    put:
      tags:
        - TranslatorsLanguage
      summary: Replace all languages of a user
      operationId: replaceUserLanguages
      description: >
        Replaces all existing languages of the specified user with a new set.
        (Accessible by TRANSLATOR themselves)
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the user
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplaceLanguagesRequest'
      responses:
        '200':
          description: Languages replaced successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListLanguagesResponse'
        '400':
          description: Invalid input data.
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to modify this resource.
        '404':
          description: User not found.
        '405':
          description: Unsupported HTTP method.
        '500':
          description: Internal server error.


  # ------ Project Endpoints -----
  /projects:
    post:
      tags:
        - Projects
      summary: Creates a new project using the current user as the customer.
      description: >
        Creates a new translation project with the provided target language and content.
        The authenticated user is set as the customer for the project. (Only CUSTOMER can access this endpoint.)
      operationId: createProject
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/CreateProjectRequest"
        required: true
      responses:
        '201':
          description: Project was successfully created.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        '400':
          description: Request body is not formatted correctly.
        '403':
          description: Current user is not authorized to create projects.
        '405':
          description: Unsupported HTTP method.
        '406':
          description: Not acceptable response representation.
        '500':
          description: Server error.
    get:
      tags:
        - Projects
      summary: List all projects with optional filters.
      description: >
        Retrieves a list of all projects in the system, with optional filtering
        by state, target language, and feedback presence. (ALL ROLES USERS CAN ACCESS)
        Every user sees only projects they are authorized to view.
      operationId: listAllProjects
      parameters:
        - in: query
          name: state
          schema:
            $ref: '#/components/schemas/ProjectState'
          description: Filter projects by their state.
          required: false
        - in: query
          name: languageCode
          schema:
            type: string
            minLength: 2
            maxLength: 2
            description: Filter projects by target language (ISO 639-1 code).
          required: false
        - in: query
          name: hasFeedback
          schema:
            type: boolean
            description: Filter projects based on whether they have feedback.
          required: false


      responses:
        '200':
          description: Projects retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListProjectsResponse"
        '403':
          description: Current user is not authorized to list projects.
        '405':
          description: Unsupported HTTP method.
        '406':
          description: Not acceptable response representation.
        '500':
          description: Server error.
  /projects/{id}:
    get:
      tags:
        - Projects
      summary: Get project by ID
      description: >
        Retrieves the details of a project by its unique ID.
        (ALL ROLES USERS CAN ACCESS this endpoint; user sees only projects they are authorized to view.)
      operationId: getProjectDetails
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: Project not found
        '500':
          description: Server error.
  /projects/{id}/original:
    get:
      tags:
        - Projects
      summary: Download the original content of a project
      description: >
        Retrieves the original content file of the specified project.
        (customer  or assigned translator can perform this)
      operationId: downloadOriginalContent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Original content retrieved successfully.
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.
  /projects/{id}/translated:
    get:
      tags:
        - Projects
      summary: Download the translated content of a project (customer, admin, or assigned translator can perform this)
      description: >
        Retrieves the translated content file of the specified project.
        (customer or assigned translator can perform this)
      operationId: downloadTranslatedContent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Translated content retrieved successfully.
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.
    put:
      tags:
        - ProjectsWorkflow
      summary: Upload translated content for a project (Only translator for this project can perform this )
      description: >
        Allows the assigned translator to upload the translated content file
        for the specified project. (Only translator for this project can perform this )
      operationId: uploadTranslatedContent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
          description: Translated content uploaded successfully.
        '400':
          description: Invalid input data.
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to modify this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.

  /projects/{id}/approve:
    post:
      tags:
        - ProjectsWorkflow
      summary: Approve the translated content of a project (only customer who created the project can perform this)
      description: >
        Allows the customer who created the project to approve
        the translated content, marking the project as approved. (only customer who created the project can perform this)
      operationId: approveTranslatedContent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
          description: Translated content approved successfully.
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to modify this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.
  /projects/{id}/reject:
    post:
      tags:
        - ProjectsWorkflow
      summary: Reject the translated content of a project (only customer who created the project can perform this)
      description: >
        Allows the customer who created the project to reject
        the translated content, providing feedback for improvements. (only customer who created the project can perform this)
      operationId: rejectTranslatedContent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectFeedbackRequest'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
          description: Translated content rejected successfully.
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to modify this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.
  /projects/{id}/close:
    post:
      tags:
        - ProjectsWorkflow
      summary: Close a project (only admin can perform this)
      description: >
        Close the project ultimately, marking it as closed.
        (only admin can perform this)
      operationId: closeProject
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

          description: Project closed successfully.
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to modify this resource.
        '404':
          description: Project not found.
        '500':
          description: Server error.


  # ------ Feedback Endpoints -----
  /projects/{id}/feedback:
    get:
      tags:
        - ProjectsFeedback
      summary: Get feedback for a project
      description: >
        Get the feedback associated with a specific project.
        (EVERY ROLE can access this endpoint; user sees feedback only for projects they are authorized to view.)
      operationId: getProjectFeedback
      parameters:
        - name: id
          description: Id of the project
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Feedback retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectFeedback'
        '401':
          description: Unauthorized - no valid authentication token provided.
        '403':
          description: Forbidden - insufficient permissions to access this resource.
        '404':
          description: Project or feedback not found.
        '500':
          description: Server error.
























components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

    cookieAuth:
      type: apiKey
      in: cookie
      name: refreshToken





  schemas:
    #----- User Schemas -----
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "d290f1ee-6c54-4b01-90e6-d701748f0851"
        name:
          type: string
          example: "John Doe"
        emailAddress:
          type: string
          format: email
          example: "john.doe@example.com"
        role:
          $ref: '#/components/schemas/UserRole'
        languages:
          type: array
          items:
            type: string
            example: "en"
          description: ISO language codes
        createdAt:
          type: string
          format: date-time
          example: "2025-10-15T09:33:20Z"
      required:
        - id
        - name
        - emailAddress
        - role
        - createdAt
    UserRole:
      type: string
      enum:
        - CUSTOMER
        - TRANSLATOR
        - ADMINISTRATOR
    
    #??? MAYBE HEADERS ???
    UserHeader:
      type: object
      description: A lightweight user representation for headers
      properties:
        id:
          type: string
          format: uuid
          example: "d290f1ee-6c54-4b01-90e6-d701748f0851"
        name:
          type: string
          example: "John Doe"
        role:
          $ref: '#/components/schemas/UserRole'
      required:
        - id
        - name
        - role
    ### USER REQUESTS ###
    ReplaceLanguagesRequest:
      type: array
      items:
        type: string
        example: en
    ### USER RESPONSES ###
    ListUsersResponse:
      type: array
      items:
        $ref: '#/components/schemas/User'
    ListLanguagesResponse:
      type: array
      items:
        type: string
        example: en





    #----- Auth Schemas -----
    LoginUserRequest:
      type: object
      required: [ emailAddress, password ]
      additionalProperties: false
      properties:
        emailAddress:
          type: string
          format: email
        password:
          type: string
          format: password
    RegisterUserRequest:
      oneOf:
        - $ref: '#/components/schemas/RegisterCustomerRequest'
        - $ref: '#/components/schemas/RegisterTranslatorRequest'
      discriminator:
        propertyName: type
        mapping:
          customer: '#/components/schemas/RegisterCustomerRequest'
          translator: '#/components/schemas/RegisterTranslatorRequest'
    RegisterCustomerRequest:
      type: object
      required: [ type, name, emailAddress, password ]
      additionalProperties: false
      properties:
        type:
          type: string
          example: customer
        name:
          type: string
        emailAddress:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
    RegisterTranslatorRequest:
      type: object
      required: [ type, name, emailAddress, password, languages ]
      additionalProperties: false
      properties:
        type:
          type: string
          example: translator
        name:
          type: string
        emailAddress:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        languages:
          type: array
          items:
            type: string
    ### AUTH RESPONSES ###
    AuthJWTResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required:
        - accessToken



    #----- Project Schemas -----
    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier of the created project
        targetLanguage:
          type: string
          example: "de"
        originalFileName:
          type: string
          example: "document.txt"
        translatedFileName:
          type: string
          example: "document_de.txt"
        customer:
          $ref:
            '#/components/schemas/User'
        translator:
          $ref:
            '#/components/schemas/User'
        state:
          $ref: '#/components/schemas/ProjectState'
        createdAt:
          type: string
          format: date-time



    ProjectState:
      type: string
      enum:
        - CREATED
        - ASSIGNED
        - COMPLETED
        - APPROVED
        - CLOSED

    ### PROJECT REQUESTS ###
    CreateProjectRequest:
      type: object
      required: [ languageCode, content ]
      additionalProperties: false
      properties:
        languageCode:
          type: string
          minLength: 2
          maxLength: 2
          example: "de"
          description: Target language ISO 639-1 code.
        content:
          type: string
          format: binary
          description: Text content to be translated.

    ### PROJECT RESPONSES ###
    ListProjectsResponse:
      type: array
      items:
        $ref: '#/components/schemas/Project'


    #------ Project Feedback Schemas -----
    ProjectFeedback:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        text:
          type: string
          example: "This is horrible"
        createdAt:
          type: string
          format: date-time
      required: [ projectId, text ]

    ### PROJECT FEEDBACK REQUESTS ###
    ProjectFeedbackRequest:
      type: object
      required: [ text ]
      additionalProperties: false
      properties:
        text:
          type: string
          example: "This is horrible"


